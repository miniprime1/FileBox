<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>FileBox</title>
        <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
        <style>
            * { box-sizing: border-box; }
            body { font-family: system-ui, sans-serif; margin: 2rem; }
            header { display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap; }
            input { border:1px solid #ddd; padding:.6rem .7rem; height: 42px; border-radius:8px; }
            button { background:#376092; color:#fff; border:none; cursor:pointer; padding:.6rem .7rem; height: 42px; border-radius:8px; }
        </style>
    </head>
    <body>
        <div style="max-width: 900px; margin: 0 auto;">
            <header>
                <div><h1 style="display: inline;">FileBox</h1> <h3 style="display: inline; color:#376092; margin:0;">{{ service_host_encoded }}</h3></div>
                <div style="color:#6b7280; font-size:.9rem; display: inline; float: right;">최대 업로드 용량은 {{ max_mb }}MB 입니다.</div>
            </header>

            <div style=" box-sizing: border-box; border:1px solid #ddd; border-radius:12px; padding:1rem; margin-top:1rem;">
                <form method="post" action="{{ url_for('upload') }}" enctype="multipart/form-data" style="display:flex; align-items:center; gap:.6rem; flex-wrap:wrap;">
                    <input type="file" style="flex: 1 1 240px; min-width: 200px;" name="file" required>
                    <input type="text" name="uploader" placeholder="작성자 (선택)">
                    <input type="password" name="password" placeholder="비밀번호 (선택)">
                    <button type="submit">업로드</button>
                </form>
            </div>

            <div style=" box-sizing: border-box; border:1px solid #ddd; border-radius:12px; padding:1rem; margin-top:1rem;">
                {% if files %}
                    {% for f in files %}
                        <form style="display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:.45rem 0;" method="post" action="{{ url_for('download') }}">
                            <div style="flex:1 1 auto; display:flex; align-items:center; gap:.4rem; flex-wrap:wrap; min-width: 240px;">
                                <span>
                                    <span style="font-weight:600;">{{ f.filename }}</span>
                                    <span style="color:#6b7280; font-size:.92rem;"> · {{ (f.size/1024/1024)|round(2) }} MB · {{ f.created_at }} · {{ f.uploader }}</span>
                                </span>
                            </div>
                            <div style="display:flex; align-items:center; gap:.6rem; flex: 0 0 auto; ">
                                <input type="hidden" name="filename" value="{{ f.filename }}">
                                {% if f.password %}
                                    <input style="width: 160px;" type="password" name="password" placeholder="비밀번호" required>
                                {% endif %}
                                <button type="submit">다운로드</button>
                            </div>
                        </form>
                        {% if not loop.last %}<hr style="border: none; border-top: 1px solid #eee; margin:.4rem 0;">{% endif %}
                    {% endfor %}
                {% else %}
                    <p>아직 업로드된 파일이 없습니다.</p>
                {% endif %}
            </div>
        </div>

        <footer style="margin:2rem 0 1rem; color:#6b7280; font-size:.85rem; text-align:center;">
            FileBox는 로그인 없이 파일을 업로드·다운로드할 수 있는 간단한 파일 공유 솔루션입니다.
            <br><br>
            <a href="https://github.com/miniprime1/FileBox" target="_blank" aria-label="GitHub" style="color:#376092; text-decoration:none; display:inline-flex; align-items:center; gap:.4rem;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 .5C5.65.5.5 5.65.5 12c0 5.1 3.29 9.4 7.86 10.94.58.1.79-.25.79-.56
                            0-.27-.01-1.16-.02-2.1-3.2.7-3.88-1.54-3.88-1.54-.53-1.34-1.3-1.7-1.3-1.7-1.06-.72.08-.7.08-.7
                            1.17.08 1.78 1.2 1.78 1.2 1.04 1.78 2.74 1.26 3.4.96.1-.75.41-1.26.74-1.55-2.55-.29-5.23-1.28-5.23-5.7
                            0-1.26.45-2.3 1.2-3.11-.12-.3-.52-1.52.11-3.18 0 0 .98-.31 3.2 1.18a11.1 11.1 0 0 1 5.82 0c2.22-1.49 
                            3.2-1.18 3.2-1.18.63 1.66.23 2.88.11 3.18.75.81 1.2 1.85 1.2 3.11 0 4.43-2.68 5.41-5.24 5.69.42.36.8 
                            1.08.8 2.17 0 1.56-.01 2.82-.01 3.2 0 .31.21.67.8.56A10.52 10.52 0 0 0 23.5 12C23.5 5.65 18.35.5 12 .5z"/>
                </svg>
                GitHub
            </a>
        </footer>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <script>
                    {% for m in messages %}
                        alert("{{ m }}");
                    {% endfor %}
                </script>
            {% endif %}
        {% endwith %}
    </body>
</html>